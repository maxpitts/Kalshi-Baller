<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>YOLO ENGINE v3 â€” Crypto Scalper</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#07060d;--card:rgba(14,12,24,0.92);--border:rgba(255,255,255,0.06);--accent:#f59e0b;--green:#22c55e;--red:#ef4444;--purple:#a855f7;--blue:#3b82f6;--cyan:#06b6d4;--dim:rgba(255,255,255,0.35);--text:#f0f0f0;--mono:'JetBrains Mono',monospace;--sans:'Outfit',sans-serif}
body{background:var(--bg);color:var(--text);font-family:var(--sans);overflow-x:hidden;min-height:100vh}
.bg{position:fixed;inset:0;z-index:0;overflow:hidden}
.bg::before{content:'';position:absolute;top:20%;left:30%;width:600px;height:600px;background:radial-gradient(circle,rgba(245,158,11,0.04),transparent 70%);animation:pulse 8s ease-in-out infinite}
.bg::after{content:'';position:absolute;bottom:10%;right:20%;width:500px;height:500px;background:radial-gradient(circle,rgba(168,85,247,0.03),transparent 70%);animation:pulse 12s ease-in-out infinite reverse}
@keyframes pulse{0%,100%{transform:scale(1);opacity:0.5}50%{transform:scale(1.3);opacity:1}}
.app{position:relative;z-index:1;max-width:1400px;margin:0 auto;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid var(--border);margin-bottom:20px;flex-wrap:wrap;gap:10px}
.logo{display:flex;align-items:center;gap:14px}
.logo-icon{font-size:28px}
.logo h1{font-size:18px;font-weight:800;letter-spacing:2px;background:linear-gradient(135deg,var(--accent),#fb923c);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo sub{font-size:11px;color:var(--dim);letter-spacing:1px;font-weight:400}
.controls{display:flex;gap:8px;align-items:center}
.btn{font-family:var(--mono);font-size:12px;font-weight:600;padding:8px 18px;border:1px solid var(--border);border-radius:8px;background:rgba(255,255,255,0.04);color:var(--text);cursor:pointer;transition:all 0.2s;letter-spacing:0.5px}
.btn:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.12)}
.btn.go{background:rgba(34,197,94,0.15);border-color:rgba(34,197,94,0.3);color:var(--green)}
.btn.stop{background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.3);color:var(--red)}
.badge{font-family:var(--mono);font-size:11px;padding:5px 12px;border-radius:16px;letter-spacing:1px;font-weight:700}
.ticker{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:10px;padding:10px 16px;margin-bottom:16px;display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.ticker .btc{font-family:var(--mono);font-size:22px;font-weight:700;color:var(--accent);white-space:nowrap}
.ticker .chip{font-family:var(--mono);font-size:11px;padding:4px 10px;border-radius:6px;font-weight:600;white-space:nowrap}
.ticker .meta{font-size:11px;color:var(--dim);white-space:nowrap}
.grid{display:grid;grid-template-columns:280px 1fr 300px;gap:16px;margin-bottom:16px}
@media(max-width:1100px){.grid{grid-template-columns:1fr 1fr} .grid>:last-child{grid-column:span 2}}
@media(max-width:700px){.grid{grid-template-columns:1fr} .grid>:last-child{grid-column:span 1}}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;position:relative;overflow:hidden}
.card-title{font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);margin-bottom:12px;font-weight:600}
.big-num{font-family:var(--mono);font-size:32px;font-weight:700;line-height:1}
.sub-num{font-family:var(--mono);font-size:13px;color:var(--dim);margin-top:4px}
.countdown{text-align:center;padding:24px 18px}
.countdown .time{font-family:var(--mono);font-size:40px;font-weight:700;letter-spacing:3px}
.countdown .time .colon{animation:blink 1s step-end infinite;opacity:0.5}
@keyframes blink{0%,100%{opacity:0.5}50%{opacity:0.15}}
.progress-wrap{background:rgba(255,255,255,0.04);border-radius:6px;height:6px;margin-top:10px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),#fb923c);border-radius:6px;transition:width 0.5s}
.bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:700px){.bottom-grid{grid-template-columns:1fr}}
.log-entry{display:flex;gap:8px;padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.03);font-size:12px}
.log-entry .ts{font-family:var(--mono);color:var(--dim);font-size:10px;white-space:nowrap}
.log-entry .ev{font-weight:600;white-space:nowrap}
.log-entry .det{color:var(--dim);font-family:var(--mono);font-size:11px;word-break:break-all}
.bet-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.03);font-family:var(--mono);font-size:12px}
.side{font-weight:700;padding:2px 6px;border-radius:4px;font-size:10px;letter-spacing:0.5px}
.side.yes{background:rgba(34,197,94,0.15);color:var(--green)}
.side.no{background:rgba(239,68,68,0.15);color:var(--red)}
.dots{display:flex;gap:4px;flex-wrap:wrap;padding:8px 0}
.dot{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;font-family:var(--mono)}
.dot.w{background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)}
.dot.l{background:rgba(239,68,68,0.15);color:var(--red);border:1px solid rgba(239,68,68,0.3)}
.breaker{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:10px;padding:12px 16px;margin-bottom:16px;display:none;align-items:center;gap:12px;font-family:var(--mono);font-size:13px}
.breaker.active{display:flex}
.shield-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
@media(max-width:900px){.shield-grid{grid-template-columns:repeat(2,1fr)}}
.shield{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 14px;text-align:center}
.shield .lbl{font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);font-weight:600}
.shield .val{font-family:var(--mono);font-size:20px;font-weight:700;margin-top:4px}
</style>
</head>
<body>
<div class="bg"></div>
<div class="app">
  <div class="header">
    <div class="logo">
      <div class="logo-icon">âš¡</div>
      <div><h1>YOLO ENGINE v3</h1><sub>CRYPTO MISPRICING SCALPER Â· BTC / ETH / SOL</sub></div>
    </div>
    <div class="controls">
      <div id="modeBadge" class="badge" style="background:rgba(6,182,212,0.15);border:1px solid rgba(6,182,212,0.3);color:var(--cyan)">FADE MODE</div>
      <button class="btn go" onclick="doStart()">START</button>
      <button class="btn stop" onclick="doStop()">STOP</button>
      <button class="btn" onclick="doPause()">PAUSE</button>
    </div>
  </div>

  <div class="ticker">
    <div class="btc" id="btcPrice">$â€”</div>
    <div id="stratChip" class="chip" style="background:rgba(6,182,212,0.12);color:var(--cyan)">SCANNING</div>
    <div class="meta">Strategy: <span id="strategyLabel" style="color:var(--cyan);font-weight:600">Loading...</span></div>
    <div class="meta" style="margin-left:auto" id="btcSource">â€”</div>
  </div>

  <div class="breaker" id="breakerBanner">
    <div style="font-size:20px">ðŸ§Š</div>
    <div><strong>CIRCUIT BREAKER ACTIVE</strong> â€” Paused after consecutive losses. Cooling down.</div>
  </div>

  <div class="shield-grid">
    <div class="shield"><div class="lbl">Streak</div><div class="val" id="streakVal">â€”</div></div>
    <div class="shield"><div class="lbl">Drawdown</div><div class="val" id="drawdownVal">0%</div></div>
    <div class="shield"><div class="lbl">Win Rate</div><div class="val" id="wrVal">â€”</div></div>
    <div class="shield"><div class="lbl">Observations</div><div class="val" id="sizingVal">0</div></div>
  </div>

  <div class="grid">
    <div>
      <div class="card countdown"><div class="card-title">Countdown</div><div class="time" id="countdown">48<span class="colon">:</span>00<span class="colon">:</span>00</div></div>
      <div class="card" style="margin-top:12px">
        <div class="card-title">Bankroll</div>
        <div class="big-num" id="bankroll">$100.00</div>
        <div class="sub-num"><span id="pnl">$0.00</span> (<span id="pnlPct">0.0</span>%)</div>
        <div class="progress-wrap"><div class="progress-fill" id="progressBar" style="width:0%"></div></div>
        <div class="sub-num" style="margin-top:6px">Peak: $<span id="peak">100.00</span> Â· Target: $<span id="targetVal">10,000</span></div>
      </div>
    </div>
    <div>
      <div class="card" style="min-height:200px"><div class="card-title">Active Positions</div><div id="activePositions" style="font-family:var(--mono);font-size:12px;color:var(--dim)">No active bets</div></div>
      <div class="card" style="margin-top:12px"><div class="card-title">Win / Loss Pattern</div><div class="dots" id="wlDots"></div></div>
    </div>
    <div>
      <div class="card">
        <div class="card-title">Performance</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div><div style="font-size:10px;color:var(--dim)">BETS</div><div style="font-family:var(--mono);font-size:18px;font-weight:700" id="totalBets">0</div></div>
          <div><div style="font-size:10px;color:var(--dim)">WIN RATE</div><div style="font-family:var(--mono);font-size:18px;font-weight:700" id="winRate">0%</div></div>
          <div><div style="font-size:10px;color:var(--dim)">WINS</div><div style="font-family:var(--mono);font-size:18px;font-weight:700;color:var(--green)" id="wins">0</div></div>
          <div><div style="font-size:10px;color:var(--dim)">LOSSES</div><div style="font-family:var(--mono);font-size:18px;font-weight:700;color:var(--red)" id="losses">0</div></div>
          <div style="grid-column:span 2"><div style="font-size:10px;color:var(--dim)">WAGERED</div><div style="font-family:var(--mono);font-size:16px;font-weight:600" id="wagered">$0.00</div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-grid">
    <div class="card" style="max-height:400px;overflow-y:auto"><div class="card-title">Event Log</div><div id="eventLog"></div></div>
    <div class="card" style="max-height:400px;overflow-y:auto"><div class="card-title">Recent Bets</div><div id="recentBets"></div></div>
  </div>
</div>

<script>
let ws, status = {};
function connect() {
  const proto = location.protocol === 'https:' ? 'wss' : 'ws';
  ws = new WebSocket(`${proto}://${location.host}`);
  ws.onmessage = e => { try { const msg = JSON.parse(e.data); if (msg.type === 'status') update(msg.data); } catch(e){} };
  ws.onclose = () => setTimeout(connect, 2000);
  ws.onerror = () => ws.close();
}
function update(s) {
  status = s;
  if (s.btc) {
    const p = s.btc.price;
    document.getElementById('btcPrice').textContent = p ? `$${p.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}` : '$â€”';
    document.getElementById('btcSource').textContent = s.btc.source || s.source || 'â€”';
  }
  if (s.strategy) document.getElementById('strategyLabel').textContent = s.strategy;
  const chip = document.getElementById('stratChip');
  const active = (s.active || []).length;
  if (s.phase === 'LEARNING') { chip.textContent = 'ðŸ“š LEARNING'; chip.style.background = 'rgba(251,191,36,0.12)'; chip.style.color = '#fbbf24'; }
  else if (active > 0) { chip.textContent = `${active} ACTIVE`; chip.style.background = 'rgba(34,197,94,0.12)'; chip.style.color = 'var(--green)'; }
  else { chip.textContent = 'SCANNING'; chip.style.background = 'rgba(6,182,212,0.12)'; chip.style.color = 'var(--cyan)'; }

  const banner = document.getElementById('breakerBanner');
  if (s.stats?.coolingDown) banner.classList.add('active'); else banner.classList.remove('active');

  const streak = s.stats?.streak || 0;
  const streakEl = document.getElementById('streakVal');
  if (streak > 0) { streakEl.textContent = `W${streak}`; streakEl.style.color = 'var(--green)'; }
  else if (streak < 0) { streakEl.textContent = `L${Math.abs(streak)}`; streakEl.style.color = 'var(--red)'; }
  else { streakEl.textContent = 'â€”'; streakEl.style.color = 'var(--dim)'; }

  const dd = s.stats?.drawdown || 0;
  const ddEl = document.getElementById('drawdownVal');
  ddEl.textContent = dd.toFixed(1) + '%'; ddEl.style.color = dd > 30 ? 'var(--red)' : dd > 15 ? 'var(--accent)' : 'var(--green)';

  const wr = s.stats?.wr || 0; const wrEl = document.getElementById('wrVal');
  wrEl.textContent = (s.stats?.bets || 0) > 0 ? wr + '%' : 'â€”';
  wrEl.style.color = wr >= 55 ? 'var(--green)' : wr >= 45 ? 'var(--accent)' : wr > 0 ? 'var(--red)' : 'var(--dim)';

  const sizEl = document.getElementById('sizingVal');
  if (s.stats?.observations != null) { sizEl.textContent = `${s.stats.observations} obs`; sizEl.style.color = s.stats.observations >= 10 ? 'var(--green)' : 'var(--accent)'; }
  else { sizEl.textContent = 'â€”'; }

  if (s.countdown) {
    const {h,m:mn,s:sc} = s.countdown;
    document.getElementById('countdown').innerHTML = `${String(h).padStart(2,'0')}<span class="colon">:</span>${String(mn).padStart(2,'0')}<span class="colon">:</span>${String(sc).padStart(2,'0')}`;
  }
  document.getElementById('bankroll').textContent = `$${(s.bankroll||0).toFixed(2)}`;
  const pnl = s.pnl || 0; const pnlEl = document.getElementById('pnl');
  pnlEl.textContent = `${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}`; pnlEl.style.color = pnl >= 0 ? 'var(--green)' : 'var(--red)';
  document.getElementById('pnlPct').textContent = (s.pnlPct||0).toFixed(1);
  document.getElementById('progressBar').style.width = Math.max(0, Math.min(100, s.progress||0)) + '%';
  document.getElementById('peak').textContent = (s.peak||100).toFixed(2);
  document.getElementById('targetVal').textContent = (s.target||10000).toLocaleString();

  if (s.stats) {
    document.getElementById('totalBets').textContent = s.stats.bets || 0;
    document.getElementById('winRate').textContent = (s.stats.wr||0) + '%';
    document.getElementById('wins').textContent = s.stats.wins || 0;
    document.getElementById('losses').textContent = s.stats.losses || 0;
    document.getElementById('wagered').textContent = `$${(s.stats.wagered||0).toFixed(2)}`;
  }

  const ap = document.getElementById('activePositions');
  if (s.active && s.active.length > 0) {
    ap.innerHTML = s.active.map(o => {
      const asset = (o.ticker||'').includes('ETH') ? 'âŸ ' : (o.ticker||'').includes('SOL') ? 'â—Ž' : 'â‚¿';
      return `<div style="padding:8px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
        <span>${asset} <span style="font-weight:700;color:${o.side==='yes'?'var(--green)':'var(--red)'}">${(o.side||'').toUpperCase()}</span> ${o.ticker}</span>
        <span style="color:var(--dim)">${o.price}Â¢ Ã—${o.contracts} Â· ${o.mins}min</span></div>`;
    }).join('');
  } else ap.innerHTML = '<div style="color:var(--dim);padding:20px 0;text-align:center">No active bets</div>';

  if (s.recentBets) {
    document.getElementById('wlDots').innerHTML = s.recentBets.slice().reverse().map(b =>
      `<div class="dot ${b.won?'w':'l'}" title="${b.ticker} ${b.won?'+':'-'}$${Math.abs(b.pnl||0).toFixed(2)}">${b.won ? 'âœ“' : 'âœ—'}</div>`
    ).join('');
  }
  if (s.log) {
    document.getElementById('eventLog').innerHTML = s.log.slice(0,30).map(l =>
      `<div class="log-entry"><span class="ts">${new Date(l.t).toLocaleTimeString()}</span><span class="ev">${l.ev}</span><span class="det">${l.d}</span></div>`
    ).join('');
  }
  if (s.recentBets) {
    document.getElementById('recentBets').innerHTML = s.recentBets.slice(0,15).map(b => {
      const asset = (b.ticker||'').includes('ETH') ? 'âŸ ' : (b.ticker||'').includes('SOL') ? 'â—Ž' : 'â‚¿';
      return `<div class="bet-row"><span>${asset} <span class="side ${b.side}">${(b.side||'').toUpperCase()}</span> ${(b.ticker||'').slice(0,22)}</span>
        <span style="color:${b.won?'var(--green)':'var(--red)'};font-weight:700">${b.won?'+':'-'}$${Math.abs(b.pnl||0).toFixed(2)}</span></div>`;
    }).join('') || '<div style="color:var(--dim);text-align:center;padding:20px">No bets yet</div>';
  }
}
setInterval(() => {
  if (!status.countdown) return;
  let t = status.countdown.total; if (t <= 0) return; t = Math.max(0, t - 1);
  status.countdown.total = t; status.countdown.h = Math.floor(t/3600);
  status.countdown.m = Math.floor((t%3600)/60); status.countdown.s = Math.floor(t%60);
  const {h,m,s} = status.countdown;
  document.getElementById('countdown').innerHTML = `${String(h).padStart(2,'0')}<span class="colon">:</span>${String(m).padStart(2,'0')}<span class="colon">:</span>${String(s).padStart(2,'0')}`;
}, 1000);
function doStart() {
  document.querySelector('.btn.go').textContent = 'STARTING...';
  fetch('/api/start', {method:'POST'}).then(r => r.json()).then(d => {
    if (d.error) { alert('Start failed: ' + d.error); document.querySelector('.btn.go').textContent = 'START'; }
    else document.querySelector('.btn.go').textContent = 'â— RUNNING';
  }).catch(e => { alert('Start failed: ' + e.message); document.querySelector('.btn.go').textContent = 'START'; });
}
function doStop() { fetch('/api/stop',{method:'POST'}).then(r=>r.json()).then(()=>{document.querySelector('.btn.go').textContent='START'}).catch(e=>alert(e.message)); }
function doPause() { fetch('/api/pause',{method:'POST'}).then(r=>r.json()).then(d=>alert(d.paused?'Bot PAUSED':'Bot RESUMED')).catch(e=>alert(e.message)); }
connect();
fetch('/api/status').then(r=>r.json()).then(update).catch(()=>{});
</script>
</body>
</html>
